---
title: "Shiny web"
author: "Ana Alonso Bartolomé"
date: "2024-07-13"
output: html_document
---

## Task 3

**Prepare a shiny web application using your own data.**

1.  Applications should have at least 3 inputs widgets to control the presentation of the data.

2.  Marks will be awarded for improved styling 

```{r}
install.packages("shinythemes")
```

```{r}
library(shiny)
library(ggplot2)
library(readxl)
library(dplyr)

# Load your Excel data
SCdata <- read_excel("C:/Users/Usuario/Downloads/SCdata.xlsx")  # Update with your file path

# Perform data transformation and fitting
SCdata <- SCdata %>%
  group_by(Condition) %>%
  mutate(
    fit = predict(
      nls(BRET ~ B_max * NG_NLF / (K_d + NG_NLF),
          start = list(B_max = max(BRET), K_d = 1),
          data = cur_data())
    )
  )

# Define UI
ui <- fluidPage(
  titlePanel("Saturation Curve Explorer"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("receptors", "Select Receptors:",
                  choices = sort(unique(SCdata$Receptor)),
                  multiple = TRUE,
                  selected = "CXCR4"  # Set CXCR4 as default selected
      ),
      uiOutput("condition_selector")
    ),
    
    mainPanel(
      plotOutput("saturationPlot")
    )
  )
)

# Define server
server <- function(input, output, session) {
  
  # Reactive expression for filtering data
  filtered_data <- reactive({
    req(input$receptors, input$conditions)
    SCdata %>%
      filter(Receptor %in% input$receptors,
             Condition %in% input$conditions)
  })
  
  # Update conditions selector based on selected receptors
  observe({
    req(input$receptors)
    updateCheckboxGroupInput(session, "conditions",
                             choices = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])),
                             selected = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])))
  })
  
  # Render UI for conditions selector
  output$condition_selector <- renderUI({
    req(input$receptors)
    checkboxGroupInput("conditions", "Select Conditions:",
                       choices = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])),
                       selected = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])))
  })
  
  # Render plot based on filtered data
  output$saturationPlot <- renderPlot({
    ggplot(filtered_data(), aes(x = NG_NLF, y = BRET, color = Condition)) +
      geom_point() +
      geom_line(aes(y = fit), linetype = "dotted") +
      labs(title = "Saturation Curve",
           x = "NG/NLF",
           y = "BRET ratio - background (BU)",
           color = "Condition") +
      theme_minimal()
  })
  
}

# Run the application
shinyApp(ui = ui, server = server)
```

```{r}
library(readxl)
library(ggplot2)

SCdata <- read_excel("C:/Users/Usuario/Downloads/SCdata.xlsx")

SCdata <- SCdata %>%
  group_by(Condition) %>%
  mutate(
    fit = predict(
      nls(BRET ~ B_max * NG_NLF / (K_d + NG_NLF),
          start = list(B_max = max(BRET), K_d = 1),
          data = cur_data())
    )
  )

ggplot(SCdata, aes(x = NG_NLF, y = BRET, color = Condition)) +
  geom_point() +
  geom_line(aes(y = fit), linetype = "dotted") +
  labs(title = 'Saturation Curve',
       x = 'NG/NLF',
       y = 'BRET ratio - background (BU)') +
  theme_minimal()

```

```{r}

CRCdata <- read_excel("C:/Users/Usuario/Downloads/CRCdata.xlsx")

```

```{r}
library(shiny)
library(ggplot2)
library(readxl)
library(dplyr)
library(shinythemes)

# Load your Excel data
SCdata <- read_excel("C:/Users/Usuario/Downloads/SCdata.xlsx")  # Update with your file path

# Perform data transformation and fitting
SCdata <- SCdata %>%
  group_by(Condition) %>%
  mutate(
    fit = predict(
      nls(BRET ~ B_max * NG_NLF / (K_d + NG_NLF),
          start = list(B_max = max(BRET), K_d = 1),
          data = cur_data())
    )
  )

# Define UI
ui <- fluidPage(
  # Use a custom theme
  theme = shinythemes::shinytheme("yeti"),
  
  navbarPage(
    "Saturation Curve Explorer",
    
    tabPanel("Plot",
      sidebarLayout(
        sidebarPanel(
          selectInput("receptors", "Select Receptors:",
                      choices = sort(unique(SCdata$Receptor)),
                      multiple = TRUE,
                      selected = "CXCR4"),  # Set CXCR4 as default selected
          uiOutput("condition_selector"),
          sliderInput("y_range", "Y-axis Range:",
                      min = 0, max = 2, value = c(0, 1), step = 0.1)  # Slider for y-axis range
        ),
        
        mainPanel(
          plotOutput("saturationPlot")
        )
      )
    ),
    
    tabPanel("About",
      tags$div(
        class = "container-fluid",
        h2("About Saturation Curve Explorer"),
        p("With NanoBRET, the enzyme NanoLuciferase (NLF) is fused to the receptor, while our developed constructs are labeled with the fluorescent partner NG. In presence of its substrate, NLF will emit bioluminescence. Only if the two proteins are in close proximity (<10 nm), such as with ligand induced recruitment, this bioluminescent energy is then transferred to the fluorescent acceptor, which in turn will emit a detectable fluorescent signal. Saturation binding assays can be performed by transfecting a constant amount of the NLF-Receptor DNA and increasing amounts of our NG constructs to represent increasing NG-NLF ratios. This results in a hyperbolic curve, which allows to quantify and compare protein-protein interaction pairs."),
        p("Developed using Shiny and ggplot2."),
        p("Author: Ana Alonso Bartolomé")
      )
    )
  )
)

# Define server
server <- function(input, output, session) {
  
  # Reactive expression for filtering data
  filtered_data <- reactive({
    req(input$receptors, input$conditions)
    SCdata %>%
      filter(Receptor %in% input$receptors,
             Condition %in% input$conditions)
  })
  
  # Update conditions selector based on selected receptors
  observe({
    req(input$receptors)
    updateCheckboxGroupInput(session, "conditions",
                             choices = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])),
                             selected = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])))
  })
  
  # Render UI for conditions selector
  output$condition_selector <- renderUI({
    req(input$receptors)
    checkboxGroupInput("conditions", "Select Conditions:",
                       choices = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])),
                       selected = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])))
  })
  
  # Render plot based on filtered data and y-axis range slider
  output$saturationPlot <- renderPlot({
    ggplot(filtered_data(), aes(x = NG_NLF, y = BRET, color = Condition)) +
      geom_point() +
      geom_line(aes(y = fit), linetype = "dotted") +
      labs(x = "NG/NLF",
           y = "BRET ratio - background (BU)",
           color = "Condition") +
      theme_minimal() +
      coord_cartesian(ylim = input$y_range)  # Adjust y-axis range based on slider input
  })
  
}

# Run the application
shinyApp(ui = ui, server = server)
```

```{r}
library(shiny)
library(ggplot2)
library(readxl)
library(dplyr)
library(shinythemes)

# Load your Excel data from a GitHub URL
SCdata <- read_excel("C:/Users/Usuario/Downloads/SCdata.xlsx")  # Update with your file path

# Perform data transformation and fitting
SCdata <- SCdata %>%
  group_by(Condition) %>%
  mutate(
    fit = predict(
      nls(BRET ~ B_max * NG_NLF / (K_d + NG_NLF),
          start = list(B_max = max(BRET), K_d = 1),
          data = cur_data())
    )
  )

# Define UI
ui <- fluidPage(
  # Use a custom theme
  theme = shinythemes::shinytheme("yeti"),
  
  navbarPage(
    "Saturation Curve Explorer",  # Standard title
    
    tabPanel("Plot",
      sidebarLayout(
        sidebarPanel(
          tags$h4("Select Receptors:"),  # Adjust the font size
          selectInput("receptors", NULL,
                      choices = sort(unique(SCdata$Receptor)),
                      multiple = TRUE,
                      selected = "CXCR4"),  # Set CXCR4 as default selected
          tags$h4("Select Conditions:"),  # Adjust the font size
          uiOutput("condition_selector"),
          tags$h4("Y-axis Range:"),  # Adjust the font size
          sliderInput("y_range", NULL,
                      min = 0, max = 2, value = c(0, 1), step = 0.1)  # Slider for y-axis range
        ),
        
        mainPanel(
          plotOutput("saturationPlot")
        )
      )
    ),
    
    tabPanel("About",
      fluidRow(
        column(12,
          h2("About Saturation Curve Explorer"),
          p("With NanoBRET, the enzyme NanoLuciferase (NLF) is fused to the receptor, while our developed constructs are labeled with the fluorescent partner NG. In presence of its substrate, NLF will emit bioluminescence. Only if the two proteins are in close proximity (<10 nm), such as with ligand induced recruitment, this bioluminescent energy is then transferred to the fluorescent acceptor, which in turn will emit a detectable fluorescent signal. Saturation binding assays can be performed by transfecting a constant amount of the NLF-Receptor DNA and increasing amounts of our NG constructs to represent increasing NG-NLF ratios. This results in a hyperbolic curve, which allows to quantify and compare protein-protein interaction pairs."),
          p("Developed using Shiny and ggplot2."),
          p("Author: Ana Alonso Bartolomé"),
          imageOutput("Image")  # Placeholder for the image
        )
      )
    )
  )
)

# Define server
server <- function(input, output, session) {
  
  # Reactive expression for filtering data
  filtered_data <- reactive({
    req(input$receptors, input$conditions)
    SCdata %>%
      filter(Receptor %in% input$receptors,
             Condition %in% input$conditions)
  })
  
  # Update conditions selector based on selected receptors
  observe({
    req(input$receptors)
    updateCheckboxGroupInput(session, "conditions",
                             choices = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])),
                             selected = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])))
  })
  
  # Render UI for conditions selector
  output$condition_selector <- renderUI({
    req(input$receptors)
    checkboxGroupInput("conditions", NULL,
                       choices = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])),
                       selected = sort(unique(SCdata$Condition[SCdata$Receptor %in% input$receptors])))
  })
  
  # Render plot based on filtered data and y-axis range slider
  output$saturationPlot <- renderPlot({
    ggplot(filtered_data(), aes(x = NG_NLF, y = BRET, color = Condition)) +
      geom_point() +
      geom_line(aes(y = fit), linetype = "dotted") +
      labs(x = "NG/NLF",
           y = "BRET ratio - background (BU)",
           color = "Condition") +
      theme_minimal() +
      coord_cartesian(ylim = input$y_range)  # Adjust y-axis range based on slider input
  })
  
  # Render the image in the About section
  output$Image <- renderImage({
    # Define the path to the image
    imagePath <- "C:/Users/Usuario/Downloads/Finished.jpg"
    
    # Return a list containing the path and other parameters
    list(
      src = imagePath,
      contentType = 'image/jpeg',
      width = "30%"
    )
  }, deleteFile = FALSE)  # Ensure the image is not deleted after rendering
}

# Run the application
shinyApp(ui = ui, server = server)
```
